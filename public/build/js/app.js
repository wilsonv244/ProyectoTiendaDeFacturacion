const facturas={id:"",fecha:"",hora:"",cant:"",cantidadP:[],mercaderia:[]};let stuff=[];const addProducto=document.querySelector("#add-producto"),inputCliente=document.querySelector("#buscarRuc"),inputProducto=document.querySelector("#buscar-producto"),inputNombre=document.querySelector("#nombre-cliente"),inputDireccion=document.querySelector("#direccion-cliente"),inputNumero=document.querySelector("#celular-cliente"),registrarBoleta=document.querySelector("#registrarBoleta"),registrarCantidad=document.querySelector("#cantidad-producto"),listaRecibo=document.querySelector("#lista-recibo"),allInputs=document.querySelectorAll(".dato input"),inputNombreP=document.querySelector("#nombre-producto"),inputPrecioP=document.querySelector("#precio-producto"),agregarProducto=document.querySelector(".addCompras");function seleccionarInputs(){allInputs.forEach(t=>function(){t.addEventListener("blur",(function(){console.log("Soy un Input...")}))})}document.addEventListener("DOMContentLoaded",(function(){consultarApi(),consultarApiProducto(),registrarCant(),seleccionarInputs(),desabilitarRegistro(),desabilitarProduct(),inputNombreP.addEventListener("blur",validarFormularioProd),inputPrecioP.addEventListener("blur",validarFormularioProd),registrarCantidad.addEventListener("blur",validarFormularioProd),inputCliente.addEventListener("blur",vUsuario),inputNombre.addEventListener("blur",vUsuario),inputDireccion.addEventListener("blur",vUsuario),inputNumero.addEventListener("blur",vUsuario)}));let i=0;function crearResumenProductos(t){limpiar();t.slice();t.forEach((t,e)=>{const o=document.createElement("TR");o.innerHTML=`\n        <tr>\n        <th>${e}</th>\n        <th>${t.nombre}</th>\n        <th>${cantProducto}</th>\n        <th>${t.precio_venta}</th>\n        </tr>`,agregarProducto.appendChild(o)}),console.log("xdxdxd")}function generarValoresRuc(t){inputCliente.addEventListener("blur",(function(e){const o=e.target.value;addDatos(t.filter(t=>o===t.ruc))}))}function addDatos(t){t.length>0?(addCliente(t),console.log(t[0].nombre),inputNombre.value=t[0].nombre,inputDireccion.value=t[0].direccion,inputNumero.value=t[0].numero):(inputNombre.value="",inputDireccion.value="",inputNumero.value="")}function registrarCant(){registrarCantidad.addEventListener("blur",(function(t){""===t.target.value?registrarCantidad.style.border="4px red solid":(cantProducto=t.target.value,facturas.cantidadP=[...facturas.cantidadP,...cantProducto],registrarBoleta.onclick=getBolet)}))}let datosM=[];function añadirProductos(t){let{mercaderia:e}=facturas;addProducto.addEventListener("click",(function(e){e.preventDefault(),inputNombreP.value="",inputPrecioP.value="",registrarCantidad.value="",desabilitarProduct(),facturas.mercaderia=t.map(t=>t.id),console.log(facturas),limpiar(),t.forEach(t=>{const e=document.createElement("TR");e.innerHTML=`\n            <tr>\n            <th>${t.nombre}</th>\n            <th>${t.precio_venta}</th>\n            <th>${t.precio_venta}</th>\n            </tr>`,agregarProducto.appendChild(e)})}),{once:!0})}function addCliente(t){let e=(new Date).toISOString().split("T")[0];facturas.id=t[0].id,facturas.fecha=e,facturas.hora=(new Date).toLocaleTimeString()}function generarValoresProducto(t){inputProducto.addEventListener("blur",(function(e){const o=e.target.value,r=t.filter(t=>t.codigo===o);addDatosP(r),stuff=[...stuff,...r],console.log("CANTIDA DE DATOS"+stuff.length),console.log(stuff),añadirProductos(stuff)}))}function addDatosP(t){console.log(t.length),t.length>0?(inputNombreP.value=t[0].nombre,inputPrecioP.value=t[0].precio_venta):(inputNombreP.value="",inputPrecioP.value="")}async function getBolet(){const{fecha:t,id:e,hora:o,mercaderia:r,cant:a,cantidadP:n}=facturas,c=r.map(t=>t),i=n.map(t=>t);console.log(facturas);const d=new FormData;d.append("nombre","wilson Vargas"),d.append("fecha",t),d.append("idcliente",e),d.append("hora",o),d.append("cantidadp",i),d.append("id_producto",c),console.log([...d]);try{const t="http://localhost:3000/api/enviarDatos",e=await fetch(t,{method:"POST",body:d}),o=await e.json();console.log(o)}catch(t){console.log("Hubo un error de conexion")}}async function consultarApi(){try{const t="http://localhost:3000/api/datos",e=await fetch(t),o=await e.json();console.log(o),generarValoresRuc(o)}catch(t){console.log("Error a lconsultar la Api")}}async function consultarApiProducto(){try{const t="http://localhost:3000/api/datosProducto",e=await fetch(t),o=await e.json();generarValoresProducto(o),console.log(o)}catch(t){console.log("hubo un error al traer los productos")}}function limpiar(){for(;agregarProducto.firstChild;)agregarProducto.removeChild(agregarProducto.firstChild)}function validarFormularioProd(t){""===t.target.value?console.log("falta completar datos del producto"):(addProducto.disabled=!1,addProducto.classList.remove("no-datos")),console.log(t.target.value)}function vUsuario(t){const e=t.target.value;console.log(e),""===e&&stuff.length>1?t.target.classList.add("no-producto"):(registrarBoleta.disabled=!1,registrarBoleta.classList.remove("no-datos"))}function desabilitarRegistro(){console.log(stuff.length),registrarBoleta.disabled=!0,registrarBoleta.classList.add("no-datos")}function desabilitarProduct(){addProducto.disabled=!0,addProducto.classList.add("no-datos")}